<div class="hd">
	<h1 class="title"><?php the_title(); ?></h1>
	<?php
	$attachment_id = get_field('profile-headerimage');
	$image = wp_get_attachment_image_src($attachment_id, 'theme-profile-header');
	?>
	<img src="<?= $image[0]; ?>" width="<?= $image[1]; ?>" height="<?= $image[2]; ?>"/>

</div>

<div class="bd base section">
	<div class="row">
		<div class="col-left">
			<?php
			$attachment_id = get_field('profile-logo');
			$image = wp_get_attachment_image_src($attachment_id, 'theme-profile-medium');
			?>
			<img src="<?= $image[0]; ?>" width="<?= $image[1]; ?>" height="<?= $image[2]; ?>"/>
		</div>
		<div class="col-right">
			<?php the_field('profile-description'); ?>
		</div>
	</div>
</div>

<?php if(get_field('profile-offers')): ?>
	<div class="bd base section">

		<h2>Offers</h2>

		<?php while(has_sub_field('profile-offers')): ?>

			<div class="row">

				<div class="col-left">

					<?php
					$attachment_id = get_sub_field('profile-offer-image');
					$image = wp_get_attachment_image_src($attachment_id, 'theme-profile-medium');
					?>

					<img src="<?= $image[0]; ?>" width="<?= $image[1]; ?>" height="<?= $image[2]; ?>"/>
				</div>

				<div class="col-right">
			 		<?php the_sub_field('profile-offer-description'); ?>
				</div>

			</div>
		<?php endwhile; ?>

	</div>
<?php endif; ?>


<?php if(get_field('profile-media')): ?>
	<div class="bd base section">

		<h2>Media</h2>

		<div class="row">

		<?php while(has_sub_field('profile-media')):

			if( get_sub_field('profile-media-file') ):

				$attachment_id = get_sub_field('profile-media-file');

				echo getMarkupFromAttachment($attachment_id, 'theme-profile-media');

			endif; ?>

		<?php endwhile; ?>

		</div>

	</div>

<?php endif; ?>

<?php

	//
	// ACF Relationship Query

	$facts = get_posts(array(
		'post_type' => 'icelab_facts',
		'meta_query' => array(
			array(
				'key' => 'profile', // name of custom field
				'value' => get_the_ID(), // matches exaclty "123", not just 123. This prevents a match for "1234"
				'compare' => 'LIKE'
			)
		)
	));

	if($facts): ?>

		<div class="bd base section">

			<h2>Kontakt</h2>

			<?php

			foreach( $facts as $fact): ?>

				<div class="row">
					<?= module('map')->template('contact')->data($fact)->attribs(array('role' => 'aside', 'data-id' => '1')); ?>
				</div>

			<? endforeach; ?>


		</div>

<?php endif; ?>